<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator</title>
  
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#0b1220; 
      --muted:#94a3b8;
      --accent:#60a5fa; /* blue-400 */
      --accent-2:#7c3aed; /* violet */
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent), radial-gradient(1000px 500px at 90% 90%, rgba(96,165,250,0.06), transparent), var(--bg);
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .calculator{
      width:360px;
      max-width:94vw;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.03);
    }

    .screen{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px;
      padding:12px;
      min-height:86px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
      margin-bottom:14px;
      border:1px solid var(--glass-2);
    }
    .history{
      font-size:12px;
      color:var(--muted);
      min-height:16px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .output{
      font-size:28px;
      font-weight:600;
      text-align:right;
      line-height:1;
      word-break:break-all;
    }

    .pad{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }

    button{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:14px 12px;
      font-size:18px;
      border:1px solid rgba(255,255,255,0.03);
      color:inherit;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(2,6,23,0.45);
      transition: transform 120ms cubic-bezier(.2,.9,.3,1), box-shadow 120ms;
      user-select:none;
    }
    button:active{transform:translateY(2px);}
    button:focus{outline:3px solid rgba(96,165,250,0.18);}

    .btn-operator{background:linear-gradient(180deg, rgba(124,58,237,0.12), rgba(124,58,237,0.06)); color:#fff;}
    .btn-equal{grid-column:span 2; background:linear-gradient(180deg, rgba(96,165,250,0.14), rgba(96,165,250,0.06)); font-weight:700}
    .btn-wide{grid-column:span 2}
    .btn-accent{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:var(--muted); font-weight:600}

    .small{font-size:13px}
    .muted{color:var(--muted)}

    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:12px}

    @media (max-width:420px){
      .calculator{padding:12px}
      .output{font-size:24px}
      button{padding:12px 8px;font-size:16px}
    }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Calculator">
    <div class="screen" aria-live="polite">
      <div class="history" id="history" aria-hidden="false"></div>
      <div class="output" id="display">0</div>
    </div>

    <div class="pad" role="group" aria-label="Calculator keypad">
      <button class="btn-accent small" data-action="mc" aria-label="Memory clear">MC</button>
      <button class="btn-accent small" data-action="mr" aria-label="Memory recall">MR</button>
      <button class="btn-accent small" data-action="mplus" aria-label="Memory add">M+</button>
      <button class="btn-accent small" data-action="mminus" aria-label="Memory subtract">M-</button>

      <button class="btn-accent" data-action="clear" aria-label="Clear (AC)">AC</button>
      <button class="btn-accent" data-action="back" aria-label="Backspace">⌫</button>
      <button class="btn-accent" data-action="percent" aria-label="Percent">%</button>
      <button class="btn-operator" data-value="/" aria-label="Divide">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="btn-operator" data-value="*" aria-label="Multiply">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="btn-operator" data-value="-" aria-label="Subtract">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="btn-operator" data-value="+" aria-label="Add">+</button>

      <button data-value="0" class="btn-wide">0</button>
      <button data-value="." aria-label="Decimal point">.</button>
      <button class="btn-equal" data-action="equals" aria-label="Equals">=</button>
    </div>

    <footer>Keyboard: numbers, + - * / . Enter =, Backspace, Esc (clear)</footer>
  </main>

  <script>
    (function(){
      const displayEl = document.getElementById('display');
      const historyEl = document.getElementById('history');
      const pad = document.querySelector('.pad');
      let expr = '';
      let memory = 0;

      function updateDisplay(){
        displayEl.textContent = expr === '' ? '0' : expr;
      }

      function sanitizeForEval(s){
        // allow digits, whitespace, + - * / ( ) . and %
        if(!/^[0-9+\-*/().%\s]*$/.test(s)) throw new Error('Invalid characters');
        return s.replace(/×/g,'*').replace(/÷/g,'/');
      }

      function calculate(s){
        try{
          s = s.replace(/%/g, '/100');
          s = sanitizeForEval(s);
          // Use Function instead of eval to be slightly safer and faster
          const fn = new Function('return (' + s + ')');
          const val = fn();
          if(typeof val === 'number' && isFinite(val)) return +parseFloat(val.toPrecision(12));
          throw new Error('Result not finite');
        }catch(e){
          return 'Error';
        }
      }

      function pushValue(v){
        // prevent multiple operators in a row (except parenthesis)
        if(/^[+\-*/%]$/.test(v)){
          if(expr === '') return; // no leading operator
          if(/[+\-*/%]$/.test(expr)){
            expr = expr.slice(0,-1) + v; updateDisplay(); return;
          }
        }
        expr += v;
        updateDisplay();
      }

      pad.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;
        const val = btn.dataset.value;
        const action = btn.dataset.action;

        if(action){
          switch(action){
            case 'clear': expr = ''; updateDisplay(); historyEl.textContent = ''; break;
            case 'back': expr = expr.slice(0,-1); updateDisplay(); break;
            case 'equals': {
              const result = calculate(expr);
              historyEl.textContent = expr + ' =';
              expr = (result === 'Error') ? '' : String(result);
              updateDisplay();
              break;
            }
            case 'percent': pushValue('%'); break;
            case 'mc': memory = 0; flashStatus('MC cleared'); break;
            case 'mr': expr = String(memory); updateDisplay(); flashStatus('MR'); break;
            case 'mplus': {
              const val = calculate(expr || '0');
              if(val !== 'Error') memory = Number(memory) + Number(val);
              flashStatus('M+');
              break;
            }
            case 'mminus': {
              const val = calculate(expr || '0');
              if(val !== 'Error') memory = Number(memory) - Number(val);
              flashStatus('M-');
              break;
            }
          }
        } else if(val){
          pushValue(val);
        }
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key >= '0' && e.key <= '9'){ pushValue(e.key); e.preventDefault(); return; }
        if(['+','-','*','/','(',')','.','%'].includes(e.key)){ pushValue(e.key); e.preventDefault(); return; }
        if(e.key === 'Enter' || e.key === '='){
          document.querySelector('[data-action="equals"]').click(); e.preventDefault(); return;
        }
        if(e.key === 'Backspace'){ document.querySelector('[data-action="back"]').click(); e.preventDefault(); return; }
        if(e.key === 'Escape'){ document.querySelector('[data-action="clear"]').click(); e.preventDefault(); return; }
      });

      // small UX helpers
      function flashStatus(text){
        const prev = historyEl.textContent;
        historyEl.textContent = text;
        setTimeout(()=>{ historyEl.textContent = prev; },700);
      }

      // initialize
      updateDisplay();
    })();
  </script>
</body>
</html>
